!function(t){function e(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}({7:function(t,e){!function(t,e,r){"use strict";function a(t){function e(t){function e(t,e){return-1!==e.indexOf(t)}var r=[];r.push("#"+t.id);for(var a=0;a<t.classList.length;a++)e("."+t.classList[a],r)||r.push("."+t.classList[a]);for(var n=t.getElementsByTagName("*"),o=0;o<n.length;o++){var s=n[o].id;e("#"+s,r)||r.push("#"+s);for(var i=n[o].classList,a=0;a<i.length;a++)e("."+i[a],r)||r.push("."+i[a])}for(var l="",o=0;o<document.styleSheets.length;o++){var u=document.styleSheets[o];try{if(!u.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var c=u.cssRules,d=0;d<c.length;d++)e(c[d].selectorText,r)&&(l+=c[d].cssText)}return l}function r(t,e){var r=document.createElement("style");r.setAttribute("type","text/css"),r.innerHTML=t;var a=e.hasChildNodes()?e.children[0]:null;e.insertBefore(r,a)}t.setAttribute("xlink","http://www.w3.org/1999/xlink"),r(e(t),t);var a=new XMLSerializer,n=a.serializeToString(t);return n=n.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),n=n.replace(/NS\d+:href/g,"xlink:href")}function n(t,e,r,a,n){var o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t))),s=document.createElement("canvas"),i=s.getContext("2d");s.width=e,s.height=r;var l=new Image;l.onload=function(){i.clearRect(0,0,e,r),i.drawImage(l,0,0,e,r),s.toBlob(function(t){var e=Math.round(t.length/1024)+" KB";n&&n(t,e)})},l.src=o}t.showPreliminaryOutput1=function(){for(var r=e.getState("distStatementDataVizArray"),a=e.getState("outputForDataViz"),n=e.getState("userSelectedFactors"),o=e.getState("vizConfig")||{},s=0;s<a.length;s++)for(var i=0;i<r[s].length;i++){var l,u=r[s][i]["No."],c=parseInt(u,10);if(!isNaN(c)){for(var d="Z-SCR-"+n[s],g=r[s][i][d],h=[],p=0;p<n.length;p++){var f="Z-SCR-"+n[p],m=r[s][i][f];h.push(m)}for(var v=_.pull(h,g),S=[],w=[],y=0;y<v.length;y++)g-v[y]>0?w.push("1"):S.push("1");var x;x=v.length===w.length&&n.length>1?!1!==o.shouldUseUnicode?"►":">>":v.length===S.length?!1!==o.shouldUseUnicode?"◄":"<<":"";var I="SIG"+n[s],b=r[s][i][I],N=u-1;"*"===b?l=!1!==o.shouldUseUnicode?"◉":"** ":""===b&&(l=!1!==o.shouldUseUnicode?"◎":"* "),!1!==o.shouldShowZscoreArrows?a[s][N].sigVisualization=l+x:!1===o.shouldShowZscoreArrows&&(a[s][N].sigVisualization=l)}}t.drawSynSortTrianglesForOutput(a,n)},t.drawSynSortTrianglesForOutput=function(){function o(t){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)!1===w.shouldPrependStateNo?t[e][r].displayStatements=t[e][r].sortStatement:t[e][r].displayStatements=t[e][r].statement+". "+t[e][r].sortStatement;return t}function s(t){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)if(!0===w.shouldTrimStatements){var a=t[e][r].displayStatements;t[e][r].displayStatements=a.substring(0,w.trimStatementSize)}return t}function i(t,e){for(var r,a=[],n=0;n<e.length;n++){r=0;for(var o=0;o<t.length;o++)t[o]===e[n]&&r++;a.push(r)}return a}function l(t){w.heightAdjustment=0;var e,r=[],a=_.cloneDeep(t);a.sort();for(var n=0;n<a.length;n++)a[n]!==e?r.push(1):r[r.length-1]++,e=a[n];return h=(parseInt(d,10)+10)*d3.max(r)+75}function u(t,r){var a,n=(e.getState("language"),[]);if(!0===w.shouldSetWidthForAsian)r=w.asianStatmentLength||12,n=t.match(new RegExp(".{1,"+r+"}","g"));else for(var o=new RegExp(".{0,"+r+"}(?:\\s|$)","g");""!=(a=o.exec(t));)n.push(a);return n}try{var c,d,g,h,p,f,m=e.getState("qavSortTriangleShape"),v=(e.getState("qavCurrentStatements"),e.getState("language")),S=(resources[v].translation["Synthetic Sort for"],resources[v].translation.Legend,_.uniq(m)),w=e.getState("vizConfig")||{},y="12px",x=$(".container").width()-40,I=(w.consensusCustomColor,w.matchCountCustomColor,w.overlapCustomColor,w.shouldUseToIndicateConsensus,w.shouldUseToIndicateMatchCaution,w.shouldUseToIndicateOverlap,w.shouldAddEmptySort);if(!0===w.shouldSetCardWidth?(p=w.cardWidth,x=p*S.length+10):p=x/S.length,!0===w.shouldSetFontSize&&(y=w.fontSize+"px"),!0===w.shouldSetCardHeight){var b=w.cardHeight;b===r&&(b=110),d=parseInt(b,10)}else d=110;!0===w.shouldSetSymbolFontSize?w.sigSymbolFontSize+"px":"12px",g=!0===w.shouldSetLineSpacing?w.lineSpacing:15;for(var N=e.getState("qavRespondentSortsFromDbStored"),T=e.getState("qavRespondentNames"),V=UTIL.checkUniqueName(T),z=e.getState("qavCurrentStatements"),C=e.getState("qavOriginalSortSize"),E=t.convertSortsTextToNumbers(N,C),L=[],A=0,P=E.length;A<P;A++){for(var U=[],D=0,M=E[A].length;D<M;D++){var k={};V[A]=V[A].trim(),V[A]=V[A].replace(/ /g,"_"),k.factor=V[A],k.sigVisualization="",k.sortStatement=z[D],k.sortValue=E[A][D],k.statement=D+1,U.push(k)}L.push(U)}if(!0===I){for(var R=[],q=0;q<E[0].length;q++){var O={};O.factor="",O.sigVisualization="",O.sortStatement="",O.statement=q+1,O.sortValue=E[0][q],R.push(O)}E.unshift(m),L.unshift(R),V.unshift("Q-sort Pattern")}o(L);var B;B=!0===w.shouldShowMatchCounts||w.shouldIndicateDistinguishing?40:w.shouldIndicateDistinguishing===r?40:20,!0===w.shouldTrimStatements&&s(L);var F,W=w.statementWidth||6.75;F=!0===w.shouldSetStatementWidth?parseInt((p-W)/6.75,10):parseInt(p/6.75,10);for(var G,Q=0;Q<L.length;Q++){for(var j=i(E[Q],S),H=[],Z=0,K=0;K<j.length;K++){for(var X=0;X<j[K];X++)H.push(Z);Z+=1}for(var J,Y=[],tt=0;tt<j.length;tt++){J=0;for(var et=0;et<j[tt];et++)Y.push(J),J+=1}c=l(E[Q]);var rt=Q+1,at="factorVizDiv"+rt;$("#synFactorVizDiv").append("<div id="+at+"></div>"),G=rt<10?"00":rt<100?"0":"";var nt="synSortSvgNo"+G+rt,ot=d3.select("#"+at).append("svg").attr("width",x+10).attr("height",c).attr("id",nt).attr("class","factorViz"),st=L[Q],it=st.slice(0);it.sort(function(t,e){return t.zScore===e.zScore?t.sortValue-e.sortValue:e.sortValue-t.sortValue});for(var lt=0;lt<it.length;lt++)it[lt].xVal=H[lt],it[lt].yVal=Y[lt];var ut=ot.selectAll("g.node").data(S,function(t){return t}),ct=ut.enter().append("g").attr("class","node");ct.append("rect").attr("width",p).attr("height","20").attr("x",function(t){return S.indexOf(t)*p+5}).attr("y","45").attr("fill","white").attr("stroke","black"),ct.append("text").attr("x",function(t){return S.indexOf(t)*p+p/2+5}).attr("y","57").style("text-anchor","middle").attr("class","headerText").attr("font-family","Arial").attr("font-size","14px").attr("font-weight","bold").attr("fill","black").text(function(t){return t});var dt=ot.selectAll("g.node2").data(it,function(t){return t.statement}),gt=dt.enter().append("g").attr("class","node2");gt.append("rect").attr("width",p).attr("height",d).attr("x",function(t){return t.xVal*p+5}).attr("y",function(t){return t.yVal*d+60}).attr("fill",function(t){return"#ffffff"}).style("background-color","#ffffff").attr("stroke","black"),gt.append("text").attr("class","wrap").attr("font-family","Arial").attr("font-size",y).attr("x",function(t){return t.xVal*p+8}).attr("y",function(t){return t.yVal*d+B+25}).attr("dy",0).each(function(t){for(var e=u(t.displayStatements,F),r=0;r<e.length;r++)d3.select(this).append("tspan").attr("dy",g).attr("text-anchor","middle").attr("x",t.xVal*p+p/2).text(e[r])});var ht=V[Q];ot.append("text").attr("x",5).attr("y",28).attr("font-family","Arial").attr("font-size","30px").attr("fill","black").text(ht);var pt=resources[v].translation.downloadImage,ft=$("#"+at);ft.append('<input class="svgDownloadButton blackHover" name="downloadButton" id="'+V[Q]+'Image"   type="button" value="'+V[Q]+pt+'" />'),ft.append('<input class="pngDownloadButton blackHover" name="downloadPngButton" id="'+V[Q]+'PngImage"   type="button" value="'+V[Q]+' - Download image as PNG" />')}$(".svgDownloadButton").on("mousedown",function(t){var r=e.getState("vizConfig")||{},a=r.shouldAddCustomName,n=$(this).parent().find("svg").attr("id"),o=n.slice(-3)-1,s=V[o],i=s.replace(/\s+/g,""),l=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),u=r.customName;f=!0===a?"prepend"===r.customNameLocation?{filename:u+"_"+l+"_"+i}:"append"===r.customNameLocation?{filename:l+"_"+i+"_"+u}:"replace"===r.customNameLocation?{filename:u}:{filename:l+"_"+i}:{filename:l+"_"+i},d3_save_svg.save(d3.select("#"+n).node(),f)}),$(".pngDownloadButton").on("mousedown",function(t){function r(t,e){saveAs(t,m)}var o,s=e.getState("vizConfig")||{},i=s.shouldAddCustomName,l=$(this).parent().find("svg").attr("id"),u=l.slice(-3)-1,c=V[u],d=c.replace(/\s+/g,""),g=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),h=s.customName;o=!0===i?"prepend"===s.customNameLocation?h+"_"+g+"_"+d:"append"===s.customNameLocation?g+"_"+d+"_"+h:"replace"===s.customNameLocation?h:g+"_"+d:g+"_"+d;var p=a(d3.select("#"+l).node()),f=d3.select("#"+l);n(p,2*(parseInt(f.style("width"),10)+2),2*parseInt(f.style("height"),10),"png",r);var m=o+".png"})}catch(t){console.log(t);var mt=$("#genericErrorModal .errorPanel");mt.empty(),mt.append("<p>Q-sorts must be loaded before display</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllImages=function(){try{for(var t=e.getState("qavRespondentNames"),r=0;r<t.length;r++){var a="#"+t[r]+"Image";$(a).trigger("mousedown")}}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllPngImages=function(){try{var r=e.getState("qavRespondentNames"),a=0;setInterval(function(){if(a<r.length){var e="#"+r[a]+"PngImage";t.downloadPngImage(e),a++}},2e3)}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadPngImage=function(t){console.log("triggered"),$(t).trigger("mousedown")},t.convertSortsTextToNumbers=function(t,r){var a=e.getState("qavRespondentNames"),n=[];return!1===_.isArray(t[0])?_(t).forEach(function(t,e){var o,s,i,l=0,u=2,c=[],d=r;for(o=0;o<d;o++){if(s=t.slice(l,u),i=+s,isNaN(i)){console.log("non-numeric data value");var g=$("#genericErrorModal .errorPanel");g.empty(),g.append("<p>The Q-sort for respondent "+a[e]+" contains a non-numeric data value</p>"),VIEW.showGenericErrorModal()}c.push(i),l+=2,u+=2}n.push(c)}).value():n=_.cloneDeep(t),e.setState("sortsAsNumbers",n),n}}(window.PRELIMOUT=window.PRELIMOUT||{},QAV)}});