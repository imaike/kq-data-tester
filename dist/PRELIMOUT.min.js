!function(t){function e(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}({7:function(t,e){!function(t,e,r){"use strict";function a(t){function e(t){function e(t,e){return-1!==e.indexOf(t)}var r=[];r.push("#"+t.id);for(var a=0;a<t.classList.length;a++)e("."+t.classList[a],r)||r.push("."+t.classList[a]);for(var n=t.getElementsByTagName("*"),o=0;o<n.length;o++){var s=n[o].id;e("#"+s,r)||r.push("#"+s);for(var i=n[o].classList,a=0;a<i.length;a++)e("."+i[a],r)||r.push("."+i[a])}for(var l="",o=0;o<document.styleSheets.length;o++){var u=document.styleSheets[o];try{if(!u.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var d=u.cssRules,c=0;c<d.length;c++)e(d[c].selectorText,r)&&(l+=d[c].cssText)}return l}function r(t,e){var r=document.createElement("style");r.setAttribute("type","text/css"),r.innerHTML=t;var a=e.hasChildNodes()?e.children[0]:null;e.insertBefore(r,a)}t.setAttribute("xlink","http://www.w3.org/1999/xlink"),r(e(t),t);var a=new XMLSerializer,n=a.serializeToString(t);return n=n.replace(/(\w+)?:?xlink=/g,"xmlns:xlink="),n=n.replace(/NS\d+:href/g,"xlink:href")}function n(t,e,r,a,n){var o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t))),s=document.createElement("canvas"),i=s.getContext("2d");s.width=e,s.height=r;var l=new Image;l.onload=function(){i.clearRect(0,0,e,r),i.drawImage(l,0,0,e,r),s.toBlob(function(t){var e=Math.round(t.length/1024)+" KB";n&&n(t,e)})},l.src=o}t.showPreliminaryOutput1=function(){for(var r=e.getState("distStatementDataVizArray"),a=e.getState("outputForDataViz"),n=e.getState("userSelectedFactors"),o=e.getState("vizConfig")||{},s=0;s<a.length;s++)for(var i=0;i<r[s].length;i++){var l,u=r[s][i]["No."],d=parseInt(u,10);if(!isNaN(d)){for(var c="Z-SCR-"+n[s],g=r[s][i][c],h=[],f=0;f<n.length;f++){var p="Z-SCR-"+n[f],m=r[s][i][p];h.push(m)}for(var v=_.pull(h,g),S=[],w=[],y=0;y<v.length;y++)g-v[y]>0?w.push("1"):S.push("1");var x;x=v.length===w.length&&n.length>1?!1!==o.shouldUseUnicode?"►":">>":v.length===S.length?!1!==o.shouldUseUnicode?"◄":"<<":"";var I="SIG"+n[s],b=r[s][i][I],N=u-1;"*"===b?l=!1!==o.shouldUseUnicode?"◉":"** ":""===b&&(l=!1!==o.shouldUseUnicode?"◎":"* "),!1!==o.shouldShowZscoreArrows?a[s][N].sigVisualization=l+x:!1===o.shouldShowZscoreArrows&&(a[s][N].sigVisualization=l)}}t.drawSynSortTrianglesForOutput(a,n)},t.drawSynSortTrianglesForOutput=function(){function o(t){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)!1===w.shouldPrependStateNo?t[e][r].displayStatements=t[e][r].sortStatement:t[e][r].displayStatements=t[e][r].statement+". "+t[e][r].sortStatement;return t}function s(t){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)if(!0===w.shouldTrimStatements){var a=t[e][r].displayStatements;t[e][r].displayStatements=a.substring(0,w.trimStatementSize)}return t}function i(t,e){for(var r,a=[],n=0;n<e.length;n++){r=0;for(var o=0;o<t.length;o++)t[o]===e[n]&&r++;a.push(r)}return a}function l(t){w.heightAdjustment=0;var e,r=[],a=_.cloneDeep(t);a.sort();for(var n=0;n<a.length;n++)a[n]!==e?r.push(1):r[r.length-1]++,e=a[n];return h=(parseInt(c,10)+10)*d3.max(r)+75}function u(t,r){var a,n=(e.getState("language"),[]);if(!0===w.shouldSetWidthForAsian)r=w.asianStatmentLength||12,n=t.match(new RegExp(".{1,"+r+"}","g"));else for(var o=new RegExp(".{0,"+r+"}(?:\\s|$)","g");""!=(a=o.exec(t));)n.push(a);return n}try{var d,c,g,h,f,p,m=e.getState("qavSortTriangleShape"),v=(e.getState("qavCurrentStatements"),e.getState("language")),S=(resources[v].translation["Synthetic Sort for"],resources[v].translation.Legend,_.uniq(m)),w=e.getState("vizConfig")||{},y="12px",x=$(".container").width()-40,I=(w.consensusCustomColor,w.matchCountCustomColor,w.overlapCustomColor,w.shouldUseToIndicateConsensus,w.shouldUseToIndicateMatchCaution,w.shouldUseToIndicateOverlap,w.shouldAddEmptySort);if(!0===w.shouldSetCardWidth?(f=w.cardWidth,x=f*S.length+10):f=x/S.length,!0===w.shouldSetFontSize&&(y=w.fontSize+"px"),!0===w.shouldSetCardHeight){var b=w.cardHeight;b===r&&(b=110),c=parseInt(b,10)}else c=110;!0===w.shouldSetSymbolFontSize?w.sigSymbolFontSize+"px":"12px",g=!0===w.shouldSetLineSpacing?w.lineSpacing:15;for(var N=e.getState("qavRespondentSortsFromDbStored"),T=e.getState("qavRespondentNames"),V=e.getState("qavCurrentStatements"),z=e.getState("qavOriginalSortSize"),C=t.convertSortsTextToNumbers(N,z),E=[],A=0,L=C.length;A<L;A++){for(var P=[],U=0,D=C[A].length;U<D;U++){var M={};M.factor=T[A],M.sigVisualization="",M.sortStatement=V[U],M.sortValue=C[A][U],M.statement=U+1,P.push(M)}E.push(P)}if(!0===I){for(var R=[],k=0;k<C[0].length;k++){var O={};O.factor="",O.sigVisualization="",O.sortStatement="",O.statement=k+1,O.sortValue=C[0][k],R.push(O)}C.unshift(m),E.unshift(R),T.unshift("Q-sort Pattern")}o(E);var q;q=!0===w.shouldShowMatchCounts||w.shouldIndicateDistinguishing?40:w.shouldIndicateDistinguishing===r?40:20,!0===w.shouldTrimStatements&&s(E);var B,F=w.statementWidth||6.75;B=!0===w.shouldSetStatementWidth?parseInt((f-F)/6.75,10):parseInt(f/6.75,10);for(var W,G=0;G<E.length;G++){for(var Q=i(C[G],S),j=[],H=0,Z=0;Z<Q.length;Z++){for(var K=0;K<Q[Z];K++)j.push(H);H+=1}for(var X,J=[],Y=0;Y<Q.length;Y++){X=0;for(var tt=0;tt<Q[Y];tt++)J.push(X),X+=1}d=l(C[G]);var et=G+1,rt="factorVizDiv"+et;$("#synFactorVizDiv").append("<div id="+rt+"></div>"),W=et<10?"00":et<100?"0":"";var at="synSortSvgNo"+W+et,nt=d3.select("#"+rt).append("svg").attr("width",x+10).attr("height",d).attr("id",at).attr("class","factorViz"),ot=E[G],st=ot.slice(0);st.sort(function(t,e){return t.zScore===e.zScore?t.sortValue-e.sortValue:e.sortValue-t.sortValue});for(var it=0;it<st.length;it++)st[it].xVal=j[it],st[it].yVal=J[it];var lt=nt.selectAll("g.node").data(S,function(t){return t}),ut=lt.enter().append("g").attr("class","node");ut.append("rect").attr("width",f).attr("height","20").attr("x",function(t){return S.indexOf(t)*f+5}).attr("y","45").attr("fill","white").attr("stroke","black"),ut.append("text").attr("x",function(t){return S.indexOf(t)*f+f/2+5}).attr("y","57").style("text-anchor","middle").attr("class","headerText").attr("font-family","Arial").attr("font-size","14px").attr("font-weight","bold").attr("fill","black").text(function(t){return t});var dt=nt.selectAll("g.node2").data(st,function(t){return t.statement}),ct=dt.enter().append("g").attr("class","node2");ct.append("rect").attr("width",f).attr("height",c).attr("x",function(t){return t.xVal*f+5}).attr("y",function(t){return t.yVal*c+60}).attr("fill",function(t){return"#ffffff"}).style("background-color","#ffffff").attr("stroke","black"),ct.append("text").attr("class","wrap").attr("font-family","Arial").attr("font-size",y).attr("x",function(t){return t.xVal*f+8}).attr("y",function(t){return t.yVal*c+q+25}).attr("dy",0).each(function(t){for(var e=u(t.displayStatements,B),r=0;r<e.length;r++)d3.select(this).append("tspan").attr("dy",g).attr("text-anchor","middle").attr("x",t.xVal*f+f/2).text(e[r])});var gt=T[G];nt.append("text").attr("x",5).attr("y",28).attr("font-family","Arial").attr("font-size","30px").attr("fill","black").text(gt);var ht=resources[v].translation.downloadImage,ft=$("#"+rt);ft.append('<input class="svgDownloadButton blackHover" name="downloadButton" id="'+T[G]+'Image"   type="button" value="'+T[G]+ht+'" />'),ft.append('<input class="pngDownloadButton blackHover" name="downloadPngButton" id="'+T[G]+'PngImage"   type="button" value="'+T[G]+' - Download image as PNG" />')}$(".svgDownloadButton").on("mousedown",function(t){var r=e.getState("vizConfig")||{},a=r.shouldAddCustomName,n=$(this).parent().find("svg").attr("id"),o=n.slice(-3)-1,s=T[o],i=s.replace(/\s+/g,""),l=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),u=r.customName;p=!0===a?"prepend"===r.customNameLocation?{filename:u+"_"+l+"_"+i}:"append"===r.customNameLocation?{filename:l+"_"+i+"_"+u}:"replace"===r.customNameLocation?{filename:u}:{filename:l+"_"+i}:{filename:l+"_"+i},d3_save_svg.save(d3.select("#"+n).node(),p)}),$(".pngDownloadButton").on("mousedown",function(t){function r(t,e){saveAs(t,m)}var o,s=e.getState("vizConfig")||{},i=s.shouldAddCustomName,l=$(this).parent().find("svg").attr("id"),u=l.slice(-3)-1,d=T[u],c=d.replace(/\s+/g,""),g=(UTIL.currentDate1(),UTIL.currentTime1(),e.getState("qavProjectName")),h=s.customName;o=!0===i?"prepend"===s.customNameLocation?h+"_"+g+"_"+c:"append"===s.customNameLocation?g+"_"+c+"_"+h:"replace"===s.customNameLocation?h:g+"_"+c:g+"_"+c;var f=a(d3.select("#"+l).node()),p=d3.select("#"+l);n(f,2*(parseInt(p.style("width"),10)+2),2*parseInt(p.style("height"),10),"png",r);var m=o+".png"})}catch(t){console.log(t);var pt=$("#genericErrorModal .errorPanel");pt.empty(),pt.append("<p>Q-sorts must be loaded before display</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllImages=function(){try{for(var t=e.getState("qavRespondentNames"),r=0;r<t.length;r++){var a="#"+t[r]+"Image";$(a).trigger("mousedown")}}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadAllPngImages=function(){try{var r=e.getState("qavRespondentNames"),a=0;setInterval(function(){if(a<r.length){var e="#"+r[a]+"PngImage";t.downloadPngImage(e),a++}},2e3)}catch(t){var n=$("#genericErrorModal .errorPanel");n.empty(),n.append("<p>Q-sorts must be displayed before download</p><br>"),VIEW.showGenericErrorModal()}},t.downloadPngImage=function(t){console.log("triggered"),$(t).trigger("mousedown")},t.convertSortsTextToNumbers=function(t,r){var a=e.getState("qavRespondentNames"),n=[];return!1===_.isArray(t[0])?_(t).forEach(function(t,e){var o,s,i,l=0,u=2,d=[],c=r;for(o=0;o<c;o++){if(s=t.slice(l,u),i=+s,isNaN(i)){console.log("non-numeric data value");var g=$("#genericErrorModal .errorPanel");g.empty(),g.append("<p>The Q-sort for respondent "+a[e]+" contains a non-numeric data value</p>"),VIEW.showGenericErrorModal()}d.push(i),l+=2,u+=2}n.push(d)}).value():n=_.cloneDeep(t),e.setState("sortsAsNumbers",n),n}}(window.PRELIMOUT=window.PRELIMOUT||{},QAV)}});